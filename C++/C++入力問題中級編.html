<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C++ å…¥åŠ›å•é¡Œ ä¸­ç´šç·¨</title>
  <link rel="stylesheet" href="../keep_out/style2.css">
<audio id="se-correct" src="../keep_out/correct.mp3" preload="auto"></audio>
<audio id="se-wrong" src="../keep_out/wrong.mp3" preload="auto"></audio>
<audio id="se-start" src="../keep_out/start.mp3" preload="auto"></audio>
<audio id="se-end" src="../keep_out/end.mp3" preload="auto"></audio>

</head>
<body>
  <audio id="bgm" src="../keep_out/BGM.mp3" loop></audio>
  <button id="bgm-toggle">â–¶ï¸ BGMã‚’å†ç”Ÿ</button>

  <div class="quiz-container" id="home">
    <h1>C++ å…¥åŠ›å•é¡Œ ä¸­ç´šç·¨</h1>
    <p>å…¨10å•ã§ã™ã€‚</p>
    <button onclick="startQuiz()">é–‹å§‹</button>
    <a href="C++.html" class="back-button">å•é¡Œé¸æŠã«æˆ»ã‚‹</a>
  </div>

  <div class="quiz-container" id="quiz" style="display: none;"></div>

  <script>
  const RANKING_KEY = "cpp_in_quiz_ranking_normal";
  const questions = [
  {
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’ã€åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>vector&lt;int&gt; v = {10, 20, 30};\nauto it = v.begin();\nfor(int i = 0; i < 3; i++){\n  *it += 5;\n  it++;\n}\nfor(int x : v) {\n  cout << x << endl;\n}</pre>",
  answer: "15\n25\n35",
  explanation: "v ã®å„è¦ç´ ã« 5 ã‚’åŠ ãˆã¦ã„ã‚‹ã€‚for æ–‡ã§ *it += 5 ã«ã‚ˆã‚Š <br>10â†’15, 20â†’25, 30â†’35 ã¨ãªã‚‹ã€‚<br>ãã®å¾Œ for æ–‡ã§å…¨è¦ç´ ã‚’å‡ºåŠ›ã™ã‚‹ã®ã§ã€15 25 35 ã®é †ã§å‡ºåŠ›ã•ã‚Œã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’ã€åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>vector&lt;int&gt; v = {10, 20, 30};\nauto it = v.begin();\ncout << *it << endl;\nit++;\ncout << *it << endl;</pre>",
  answer: "10\n20",
  explanation: "it ã¯ v.begin() ã§æœ€åˆã®è¦ç´ ã‚’æŒ‡ã—ã¦ãŠã‚Šã€*it ã¯ 10ã€‚\nit++ ã«ã‚ˆã‚Šæ¬¡ã®è¦ç´ ï¼ˆ20ï¼‰ã‚’æŒ‡ã™ã®ã§ã€2å›ç›®ã¯ 20 ã‚’å‡ºåŠ›ã™ã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã¨ãã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>set&lt;int&gt; s;\ns.insert(5);\ns.insert(3);\ns.insert(5);\nfor (int x : s) cout << x << endl;</pre>",
  answer: "3\n5",
  explanation: "set ã¯é‡è¤‡ã‚’è¨±ã•ãšã€æ˜‡é †ã«è‡ªå‹•ã§ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ã€‚<br>5 ã¯2å›æŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ãŒ1ã¤ã—ã‹ä¿æŒã•ã‚Œãªã„ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã¨ãã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>map&lt;string, int&gt; mp;\nmp[\"banana\"] = 5;\nmp[\"apple\"] = 2;\nfor (auto p : mp) cout << p.first << ' ' << p.second << endl;</pre>",
  answer: "apple 2\nbanana 5",
  explanation: "map ã¯ã‚­ãƒ¼ã§ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ï¼ˆæ–‡å­—åˆ—é †ï¼‰ã€‚first ãŒã‚­ãƒ¼ã€second ãŒå€¤ã§ã‚ã‚Šã€ãã‚Œã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n<pre>map&lt;string, int&gt; m;\ncout << m[\"key\"] << endl;</pre>",
  answer: "0",
  explanation: "å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆintå‹ãªã‚‰0ï¼‰ãŒæŒ¿å…¥ã•ã‚Œã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n<pre>set&lt;int&gt; s = {1, 3, 5};\nif (s.find(3) != s.end()) cout << \"yes\";\nelse cout << \"no\";</pre>",
  answer: "yes",
  explanation: "find(3) ã¯trueãªã®ã§ã€yesãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã¨ãã€å‡ºåŠ›ã•ã‚Œã‚‹ã‚‚ã®ã¯ä½•ã‹ï¼Ÿ<br>â€»å®Ÿè¡Œæ™‚ã®å‡ºåŠ›ãã®ã‚‚ã®ã§ã¯ãªãã€ã©ã®ã‚ˆã†ãªç¨®é¡ã®å€¤ãŒå‡ºã‚‹ã‹ã‚’ç­”ãˆã¦ãã ã•ã„ï¼ˆä¾‹: æ•´æ•°ã€æ–‡å­—åˆ—ãªã©ï¼‰\n<pre>set&lt;int&gt; s = {3, 5, 8};\nint x = 5;\nauto a = s.find(x);\ncout << a << endl;</pre>",
  answer: "ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿",
  explanation: "set.find(x) ã¯ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’è¿”ã™ã€‚cout << a ã¯ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹çš„ãªè¡¨ç¾ï¼ˆãƒã‚¤ãƒ³ã‚¿ã®ã‚ˆã†ãªè¡¨ç¤ºï¼‰ã«ãªã‚‹ãŸã‚ã€æ•´æ•°ã‚„boolå€¤ãªã©ã§ã¯ãªã„ã€‚<br>é€šå¸¸ã¯ *a ã§å€¤ã‚’å‚ç…§ã™ã‚‹ã€‚"
},

{
    q: `æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>
void add(int x) {
  x += 5;
}

int main() {
  int a = 10;
  add(a);
  cout << a << endl;
}</pre>`,
    answer: "10",
    explanation: "add ã¨ã„ã†é–¢æ•°ã¯å€¤æ¸¡ã—ãªã®ã§ã€é–¢æ•°å†…ã® x += 5 ã¯ a ã«ç›´æ¥å½±éŸ¿ã›ãšã€a ã¯ 10 ã®ã¾ã¾ã€‚"
  },

  {
  q: `æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>
void add(int &x) {
  x += 5;
}

int main() {
  int a = 10;
  add(a);
  cout << a << endl;
}</pre>`,
    answer: "15",
    explanation: "ã“ã‚Œã¯å‚ç…§æ¸¡ã—ãªã®ã§ã€é–¢æ•°å†…ã® x += 5 ã¯ a ã«ç›´æ¥å½±éŸ¿ã—ã¦ã€a ã¯ 15 ã«ãªã‚‹ã€‚"
  },

  {
    q: `æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>
int a = 5;
int b = 10;
int c = (a > b ? a : b);
cout << c << endl;</pre>`,
    answer: "10",
    explanation: "a > b ã¯ false ãªã®ã§ã€ä¸‰é …æ¼”ç®—å­ã®æ¡ä»¶ãŒæˆã‚Šç«‹ãŸãšã€b ãŒä»£å…¥ã•ã‚Œã‚‹ â†’ c = 10ã€‚"
  }

];

function toHalfWidth(str) {
  return str.replace(/[ï¼-ï½]/g, function(s) {
    return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
  }).replace(/ã€€/g, ' ');
}

function normalizeInput(str) {
  return toHalfWidth(str.trim()).replace(/\s+/g, ' ');
}

    function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

    let current = 0;
    let score = 0;
    let backClickCount = 0;

    const backButtonHome = document.querySelector(".back-button");
if (backButtonHome) {
  backButtonHome.addEventListener("click", function(e) {
    e.preventDefault();
    if (backClickCount === 0) {
      alert("æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚Šã¾ã™ã€‚");
      backClickCount++;
    } else {
      window.location.href = "C++.html";
    }
  });
}

    function startQuiz() {
      if(bgmToggleBtn.textContent == "â–¶ï¸ BGMã‚’å†ç”Ÿ") {
      document.getElementById('bgm').play();
      bgmToggleBtn.textContent = 'â¸ï¸ BGMã‚’åœæ­¢';
      }
      shuffle(questions);
      current = 0;
      document.getElementById("home").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      showQuestion(current);
    }

    function showQuestion(index) {
      const q = questions[index];

      const container = document.getElementById("quiz");
      container.innerHTML = "";

      const question = document.createElement("div");
      question.innerHTML = `<strong>Q${index + 1}:</strong> ${q.q}`;
      container.appendChild(question);

      const input = document.createElement("textarea");
      input.placeholder = "ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„";
      container.appendChild(input);

      const answerButton = document.createElement("button");
      answerButton.textContent = "è§£ç­”ã™ã‚‹";
      container.appendChild(answerButton);

      const result = document.createElement("div");
      result.className = "result";
      container.appendChild(result);

      const explanation = document.createElement("div");
      explanation.className = "explanation";
      container.appendChild(explanation);

      const nextButton = document.createElement("button");
      nextButton.textContent = "æ¬¡ã¸";
      nextButton.style.display = "none";
      container.appendChild(nextButton);

      const backButton = document.createElement("a");
      backButton.href = "C++.html";
      backButton.textContent = "å•é¡Œé¸æŠã«æˆ»ã‚‹";
      backButton.className = "home-button";
      container.appendChild(backButton);
      backButton.addEventListener("click", function(e) {
  e.preventDefault();
  if (backClickCount === 0) {
    alert("æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚Šã¾ã™ã€‚");
    backClickCount++;
  } else {
    window.location.href = "C++.html";
  }
});


      let emptyClickCount = 0;

      answerButton.addEventListener("click", () => {
  const userInput = input.value.trim();

  if (userInput === "") {
    emptyClickCount++;
    if (emptyClickCount === 1) {
      result.textContent = "ä½•ã‚‚å…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦æŠ¼ã™ã¨æ­£è§£ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
      result.style.color = "black";
      return;
    }
  }

  input.disabled = true;
  
  const seCorrect = document.getElementById("se-correct");
  const seWrong = document.getElementById("se-wrong");

  const normalizedUser = normalizeInput(userInput);
  const normalizedAns = normalizeInput(q.answer);
  if (normalizedUser === normalizedAns) {
  score++;
  seCorrect.currentTime = 0;
  seCorrect.play();
  result.textContent = "â—‹ æ­£è§£ã§ã™ï¼";
  result.classList.add("correct");
  result.style.color = "green";
  explanation.innerHTML = q.explanation;
} else {
  seWrong.currentTime = 0;
  seWrong.play();
  result.innerHTML = `Ã— ä¸æ­£è§£ã§ã™ã€‚<br><strong>æ­£è§£ï¼š</strong><pre>${q.answer}</pre>`;
  result.classList.add("wrong");
  result.style.color = "red";
  explanation.innerHTML = q.explanation;
}

  answerButton.style.display = "none";
  nextButton.style.display = "block";
});

  const backButtonHome = document.querySelector(".back-button");


   nextButton.addEventListener("click", () => {
    setTimeout(() => {
    current++;
    backClickCount = 0;
    if (current < questions.length) {
      showQuestion(current);
    } else {
      const seEnd = document.getElementById('se-end');
      seEnd.currentTime = 0;
      seEnd.play();
      container.innerHTML = `<h2>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼å…¨${questions.length}å•ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚<br><br>${score}å•æ­£è§£ã—ã¾ã—ãŸï¼</h2>`;
      const today = new Date().toLocaleString();
      const newRecord = { date: today, score: score };

      let ranking = JSON.parse(localStorage.getItem(RANKING_KEY) || "[]");
      ranking.push(newRecord);

      ranking.sort((a, b) => b.score - a.score);
      ranking = ranking.slice(0, 5);

      localStorage.setItem(RANKING_KEY, JSON.stringify(ranking));

      const rankingList = document.createElement("div");
      rankingList.innerHTML = "<h3>ğŸ†æ­£è§£æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°(ãƒ­ãƒ¼ã‚«ãƒ«)</h3>";

      ranking.forEach((r, i) => {
          rankingList.innerHTML += `${i + 1}ä½: ${r.score}ç‚¹ï¼ˆ${r.date}ï¼‰<br>`;
      });
      const retryBtn = document.createElement("button");
          retryBtn.textContent = "æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™";
          retryBtn.onclick = () => {
          score = 0;
          backClickCount = 0;
          shuffle(questions);
          current = 0;
          showQuestion(current);
        };

      let resetClickCount = 0;

          const resetBtn = document.createElement("button");
          resetBtn.textContent = "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ";
          resetBtn.onclick = () => {
            if (resetClickCount === 0) {
              alert("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚");
              resetClickCount++;
            } else {
              localStorage.removeItem(RANKING_KEY);
              location.reload();
            }
          };
        const backBtn = document.createElement("a");
        backBtn.href = "C++.html";
        backBtn.textContent = "å•é¡Œé¸æŠã«æˆ»ã‚‹";
        backBtn.className = "home-button";
        container.appendChild(backBtn);
        container.appendChild(retryBtn);
        container.appendChild(rankingList);
        container.appendChild(resetBtn);
    }
  },100);
  });

    }
    
    const bgm = document.getElementById('bgm');
    const bgmToggleBtn = document.getElementById('bgm-toggle');

    bgmToggleBtn.addEventListener('click', () => {
        if (!bgm.paused) {
            bgm.pause();
            bgmToggleBtn.textContent = 'â–¶ï¸ BGMã‚’å†é–‹';
        } else {
            bgm.play();
            bgmToggleBtn.textContent = 'â¸ï¸ BGMã‚’åœæ­¢';
    }
  });

  </script>
</body>
</html>
