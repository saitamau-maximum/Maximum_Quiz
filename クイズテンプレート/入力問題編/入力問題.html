<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã“ã“ãŒãƒ˜ãƒƒãƒ€ã ã‚ˆ</title>           <!--ãƒ˜ãƒƒãƒ€åã‚’è¨­å®š-->
  <link rel="stylesheet" href="../keep_out/style2.css">
  <audio id="se-correct" src="../keep_out/correct.mp3" preload="auto"></audio>
  <audio id="se-wrong" src="../keep_out/wrong.mp3" preload="auto"></audio>
</head>
<body>
  <audio id="bgm" src="../keep_out/BGM.mp3" loop></audio>
  <button id="bgm-toggle">â–¶ï¸ BGMã‚’å†ç”Ÿ</button>
  <div class="quiz-container" id="home">
    <h1>ã‚¿ã‚¤ãƒˆãƒ«</h1>  <!--ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š(ãƒ˜ãƒƒãƒ€åã¨åŒã˜ã§ã‚‚å¯)-->
    <p>å…¨5å•ã§ã™ã€‚</p> <!--å•é¡Œæ•°ã‚’è¨­å®š-->
    <button onclick="startQuiz()">é–‹å§‹</button>
    <a href="a.html" class="back-button">å•é¡Œé¸æŠã«æˆ»ã‚‹</a> <!--a.htmlã‚’å¤‰æ›´(å•é¡Œé¸æŠç”»é¢ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹)-->
  </div>

  <div class="quiz-container" id="quiz" style="display: none;"></div>

  <script>
  const RANKING_KEY = "a"; //ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ã‚­ãƒ¼ã‚’è¨­å®š
  const questions = [
/*
  {
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’åŠè§’ã®ç©ºç™½åŒºåˆ‡ã‚Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>map&lt;string, int&gt; mp;\nmp[\"a\"]++;\nmp[\"b\"] += 3;\ncout << mp[\"a\"] << \" \" << mp[\"b\"] << \" \" << mp[\"c\"] << endl;</pre>",
  answer: "1 3 0",
  explanation: "mp[\"a\"]++ ã§ a = 1ã€mp[\"b\"] += 3 ã§ b = 3ã€‚<br>å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ \"c\" ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ map ã¯åˆæœŸå€¤ 0 ã‚’æŒ¿å…¥ã—ã¦è¿”ã™ãŸã‚ã€å‡ºåŠ›ã¯ 1 3 0 ã«ãªã‚‹ã€‚"
},

  {
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã¯?\n<pre>priority_queue&lt;int&gt; pq;\npq.push(3);\npq.push(5);\npq.push(1);\ncout << pq.top() << endl;</pre>",
  answer: "5",
  explanation: "priority_queueã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å¤§ãã„é †ï¼ˆæœ€å¤§ãƒ’ãƒ¼ãƒ—ï¼‰ã«ä¸¦ã¶ãŸã‚ã€top()ã¯æœ€å¤§å€¤ã®5ã¨ãªã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã¯?\n<pre>vector&lt;pair&lt;int, int&gt;&gt; v(4);\nv[0] = {1, 3};\nv[1] = {2, 1};\nv[2] = {2, 0};\nv[3] = {1, 2};\nsort(v.begin(), v.end());\nfor (auto [a, b] : v) cout << a << \" \" << b << endl;</pre>",
  answer: "1 2\n1 3\n2 0\n2 1",
  explanation: "pairã®ã‚½ãƒ¼ãƒˆã¯è¾æ›¸é †ï¼ˆfirstãŒå°ã•ã„é †ã€åŒã˜ãªã‚‰secondãŒå°ã•ã„é †ï¼‰ã€‚<br>ã‚ˆã£ã¦é †ç•ªã¯ {1,2}, {1,3}, {2,0}, {2,1} ã¨ãªã‚‹ã€‚"
},

{
  q: "æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’1è¡Œã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n<pre>int a = 10;\nint* p = &a;\n*p += 5;\ncout << a << endl;\na += 5; cout << *p << endl;</pre>",
  answer: "15\n20",
  explanation: "ãƒã‚¤ãƒ³ã‚¿pã¯aã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡ã—ã¦ãŠã‚Šã€*p += 5 ã¯ a ã«5ã‚’åŠ ãˆã‚‹æ“ä½œã€‚<br>ã—ãŸãŒã£ã¦ a ã¯10 â†’ 15ã¨ãªã‚‹ã€‚<br>ãã®å¾Œ a += 5 ã§ a ã¯20ã«ãªã‚‹ãŒã€*p ã¯aã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã§ã€*pã‚‚20ã«ãªã‚‹ã€‚"
},

{
        q: `æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’1è¡Œã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<pre>template &lt;typename T&gt;
T mul(T x, T y) {
  return x * y;
}

cout << mul(2, 4) << endl;
cout << mul(1.5, 2.0) << endl;</pre>`,
        answer: "8\n3.0",
        explanation: "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢æ•°ã«ã‚ˆã‚Šå‹Tã«å¿œã˜ã¦æ¼”ç®—ã•ã‚Œã‚‹ã€‚2 * 4 = 8ã€1.5 * 2.0 = 3.0"
      },
      */
];
  
  function toHalfWidth(str) {
  return str.replace(/[ï¼-ï½]/g, function(s) {
    return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
  }).replace(/ã€€/g, ' ');
}

function normalizeInput(str) {
  return toHalfWidth(str.trim()).replace(/\s+/g, ' ');
}

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }


    let current = 0;
    let score = 0;
    let backClickCount = 0;

     function escapeHTMLExceptBR(str) {
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/&lt;br&gt;/g, "<br>");
}

    const backButtonHome = document.querySelector(".back-button");
if (backButtonHome) {
  backButtonHome.addEventListener("click", function(e) {
    e.preventDefault();
    if (backClickCount === 0) {
      alert("æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚Šã¾ã™ã€‚");
      backClickCount++;
    } else {
      window.location.href = "a.html";  // a.htmlã‚’å¤‰æ›´(å•é¡Œé¸æŠç”»é¢ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹)
    }
  });
}



    function startQuiz() {
      if(bgmToggleBtn.textContent == "â–¶ï¸ BGMã‚’å†ç”Ÿ") {
      document.getElementById('bgm').play();
      bgmToggleBtn.textContent = 'â¸ï¸ BGMã‚’åœæ­¢';
      }
      shuffle(questions);
      current = 0;
      document.getElementById("home").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      showQuestion(current);
    }

    function showQuestion(index) {
      const q = questions[index];

      const container = document.getElementById("quiz");
      container.innerHTML = "";

      const question = document.createElement("div");
      question.innerHTML = `<strong>Q${index + 1}:</strong> ${escapeHTMLExceptBR(q.q)}`;

      container.appendChild(question);

      const input = document.createElement("textarea");
      input.placeholder = "ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„";
      container.appendChild(input);

      const answerButton = document.createElement("button");
      answerButton.textContent = "è§£ç­”ã™ã‚‹";
      container.appendChild(answerButton);

      const result = document.createElement("div");
      result.className = "result";
      container.appendChild(result);

      const explanation = document.createElement("div");
      explanation.className = "explanation";
      container.appendChild(explanation);

      const nextButton = document.createElement("button");
      nextButton.textContent = "æ¬¡ã¸";
      nextButton.style.display = "none";
      container.appendChild(nextButton);

      const backButton = document.createElement("a");
      backButton.href = "a.html"; // a.htmlã‚’å¤‰æ›´(å•é¡Œé¸æŠç”»é¢ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹)
      backButton.textContent = "å•é¡Œé¸æŠã«æˆ»ã‚‹";
      backButton.className = "home-button";
      container.appendChild(backButton);
      backButton.addEventListener("click", function(e) {
  e.preventDefault();
  if (backClickCount === 0) {
    alert("æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚Šã¾ã™ã€‚");
    backClickCount++;
  } else {
    window.location.href = "a.html"; // a.htmlã‚’å¤‰æ›´(å•é¡Œé¸æŠç”»é¢ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹)
  }
});


    let emptyClickCount = 0;

    answerButton.addEventListener("click", () => {
    const userInput = input.value.trim();

  if (userInput === "") {
    emptyClickCount++;
    if (emptyClickCount === 1) {
      result.textContent = "ä½•ã‚‚å…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦æŠ¼ã™ã¨æ­£è§£ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
      result.style.color = "black";
      return;
    }
  }

  input.disabled = true;

  const seCorrect = document.getElementById("se-correct");
  const seWrong = document.getElementById("se-wrong");

  const normalizedUser = normalizeInput(userInput);
  const normalizedAns = normalizeInput(q.answer);
  if (normalizedUser === normalizedAns) {
    score++;
    seCorrect.currentTime = 0;
  seCorrect.play();
  result.textContent = "â—‹ æ­£è§£ã§ã™ï¼";
  result.classList.add("correct");
  result.style.color = "green";
  explanation.innerHTML = escapeHTMLExceptBR(q.explanation);

} else {
  seCorrect.currentTime = 0;
  seCorrect.play();
  result.innerHTML = `Ã— ä¸æ­£è§£ã§ã™ã€‚<br><strong>æ­£è§£ï¼š</strong><pre>${q.answer}</pre>`;
  result.classList.add("wrong");
  result.style.color = "red";
  explanation.innerHTML = escapeHTMLExceptBR(q.explanation);

}

  answerButton.style.display = "none";
  nextButton.style.display = "block";
});


   nextButton.addEventListener("click", () => {
    setTimeout(() => {
    current++;
    backClickCount = 0;
    if (current < questions.length) {
      showQuestion(current);
    } else {
      container.innerHTML = `<h2>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼å…¨${questions.length}å•ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚<br><br>${score}å•æ­£è§£ã—ã¾ã—ãŸï¼</h2>`;
     const today = new Date().toLocaleString();
      const newRecord = { date: today, score: score };

      let ranking = JSON.parse(localStorage.getItem(RANKING_KEY) || "[]");
      ranking.push(newRecord);

      ranking.sort((a, b) => b.score - a.score);
      ranking = ranking.slice(0, 5);

      localStorage.setItem(RANKING_KEY, JSON.stringify(ranking));

      const rankingList = document.createElement("div");
      rankingList.innerHTML = "<h3>ğŸ†æ­£è§£æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°(ãƒ­ãƒ¼ã‚«ãƒ«)</h3>";

      ranking.forEach((r, i) => {
          rankingList.innerHTML += `${i + 1}ä½: ${r.score}ç‚¹ï¼ˆ${r.date}ï¼‰<br>`;
      });

      const retryBtn = document.createElement("button");
          retryBtn.textContent = "æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™";
          retryBtn.onclick = () => {
          score = 0;
          backClickCount = 0;
          shuffle(questions);
          current = 0;
          showQuestion(current);
        };

        let resetClickCount = 0;

      const resetBtn = document.createElement("button");
      resetBtn.textContent = "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ";
      resetBtn.onclick = () => {
      if (resetClickCount === 0) {
          alert("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚");
          resetClickCount++;
        } else {
            localStorage.removeItem(RANKING_KEY);
            location.reload();
        }
        };
        const backBtn = document.createElement("a");
        backBtn.href = "a.html"; // a.htmlã‚’å¤‰æ›´(å•é¡Œé¸æŠç”»é¢ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹)
        backBtn.textContent = "å•é¡Œé¸æŠã«æˆ»ã‚‹";
        backBtn.className = "home-button";
        container.appendChild(backBtn);
        container.appendChild(retryBtn);
        container.appendChild(rankingList);
        container.appendChild(resetBtn);
    }
  }, 100);
  });


    }
  const bgm = document.getElementById('bgm');
  const bgmToggleBtn = document.getElementById('bgm-toggle');

  bgmToggleBtn.addEventListener('click', () => {
    if (!bgm.paused) {
      bgm.pause();
      bgmToggleBtn.textContent = 'â–¶ï¸ BGMã‚’å†é–‹';
    } else {
      bgm.play();
      bgmToggleBtn.textContent = 'â¸ï¸ BGMã‚’åœæ­¢';
  }
});

  </script>
</body>
</html>
